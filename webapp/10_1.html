<!DOCTYPE html>
<html>
<head>
  <meta charset="ISO-8859-1">
  <title>Report Output</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script  type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="http://www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"></script>
  <script type="text/javascript" src="http://www.shieldui.com/shared/components/latest/js/jszip.min.js"></script>
  	<link rel="stylesheet"
	href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css">
  <link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css"
	href="http://www.shieldui.com/shared/components/latest/css/light/all.min.css" />
<script type="text/javascript"
	src="http://www.shieldui.com/shared/components/latest/js/shieldui-all.min.js"></script>
<script type="text/javascript"
	src="http://www.shieldui.com/shared/components/latest/js/jszip.min.js"></script>
  <link rel="stylesheet" href="Style.css">
  <script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="./js/utils/constants.js"></script>
<script src="js/dynamicFilter.js"></script>

<script>
	function LoadDoc() {
		//document.getElementsByTagName("header")[0].innerHTML = HEADER_SECTION;
		//document.getElementsByTagName("footer")[0].innerHTML = FOOTER_SECTION;
		//document.getElementById("reportName").innerHTML = REPORT_NAME;
	}

	function verifying() {
		var ReportNames = localStorage.getItem('reportsData');
		
		var event = JSON.parse(ReportNames);
		var Reportname = event[0].report_name;
		
		document.getElementById("spantext").innerHTML = Reportname;
	}
</script>
<style>

</style>
</head>
<body onload="LoadDoc(); verifying();get_filterData();">
	<div id="header"><!-- <a href = "4.html">Back</a> --></div>

<div class="container">
	<div class="panel panel-default panel-box">
    <div class="panel-heading" style="text-align: center"> 
    <b >Report Name :</b> 
	    <span style=" font-size: 20px;" id="spantext"></span> 
	   
	    <!--  <img  style=" float:right;" width="30" height="25" border="0" align="center" src="images/back.jfif"/> -->
	   <!-- <a style="float: right; color:#fff; font-size:12pt;margin-top: .5%;" href = "4.html">Back</a> -->
    </div>
    		
    		 <!-- RamakrishnaD Filters Concept-->
		     <div class="well" style="border: none !important;">
		     <form id="myForm" action="#">
			      <div class="row">
				       <div  class="col-sm-2 col-md-2"style= "word-wrap: break-word; margin-top:2px;text-align: right;">
				       		<label style="word-wrap: break-word;" id="labe_div"></label>        
				       </div>
				       
				       <div class="col-sm-2 col-md-2" style="margin-top:0px;" >
					        <div style="margin-top:0px;" id="in_put"></div>   
					        <div style="margin-top:25px;" id="DB"></div>   
				       </div> 
			        </div>
		      </form>
		      <div class="pull-right" style="margin-top:-15px;">
		       <button class="btn btn-success btnRunReport" onclick="addFilter()">Run Report</button> <br><br> 
		       <a class="btn btn-success btnRunReport" href="Dashboard.jsp">Go to Dashboard </a>     

		       </div>
		      </div><!-- End Well -->
    		
        <div class="panel-body">
     
      <div class="" style="margin: 3% 2% 3% 2%;;">
        <div class="row">
        <!--  
          <div class="col-md-2">       
          </div>
          <div class="col-md-4">
            <div id="QueryResult" style=""><table><tr><td><table id="example1"  style="width: 80%" class=" table table-bordered"></table></td></tr><tr><td><table width="40%" class="display1" id="example" cellspacing="0"></table></td></tr></table></div>-->


		<div id="QueryResult"><table id="example" cellspacing="0" style="width: 100%" class=" table table-bordered"></table></div>
          
          
            <!-- <select id="selecttype" class="form-control">
              <option value="PDF">PDF</option>
              <option value="EXCEL">EXCEL</option>
              <option value="WORD">WORD</option>
            </select> -->
          </div>
          <div class="row">
        <div class="row btn-grp">
              <a type="button" id="exportButton" class="seriesBtns btn btn-default" style="background: #08C;float:right; color: white; width: 300px; margin-left: 25px;margin-top:15px; display: None;" >Export as Excel</a>
            </div>
			</div>
       </div>
       <div align="center">

						<button class="btn btn-primary"
							style="width: 100px; margin-right: 20px;";>
							<a href="reportlist.jsp" style="color: white;">Prev</a>
						</button>
						</div>
		 </div>
  </div>
</div>&emsp;&emsp;&emsp;
<div id="footer"></div></div>
</body>


<script>
	$(document).ready(function() {
		$('#next-column').click(function(event) {
			event.preventDefault();
			$('.table-container').animate({
				scrollLeft : '+=282'
			}, 'slow');
		});
		$('#previous-column').click(function(event) {
			event.preventDefault();
			$('.table-container').animate({
				scrollLeft : '-=282'
			}, 'slow');
		});
		$('#1').click(function(event) {
			event.preventDefault();
			$('.table-container').animate({
				scrollLeft : '+-=282'
			}, 'slow');
		});
		$('#2').click(function(event) {
			event.preventDefault();
			$('.table-container').animate({
				scrollLeft : '+=282'
			}, 'slow');
		});
	});
</script>

<!-- <script type="text/javascript">
	$("#exportButton").click(function() {
		var selectValue = $("#selecttype option:selected").text();

		if (selectValue == "PDF") {
			getPDFFile();
		} else if (selectValue == "WORD") {
			getWORDFile();
		} else {
			getEXCELFile();
		}
	});
</script> -->

<script
	src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>

<script>
	function getPDFFile() {
		var pdf = new jsPDF('p', 'pt', 'letter');
		source = $('#QueryResult')[0];
		/* pdf.canvas.height = 72 * 11;
		pdf.canvas.width = 72 * 8.5; */

		pdf.fromHTML(source);

		pdf.save('Report.pdf');
	};
</script>

<script>
$("#exportButton").click(function() {
	
	var ReportNames = localStorage.getItem('reportsData');
	var event = JSON.parse(ReportNames);
	var Reportname = event[0].report_name;
	var data_type = 'data:application/vnd.ms-excel';
		var table_div = document.getElementById('QueryResult');
		var table_html = table_div.outerHTML.replace(/ /g, '%20');

		var a = document.createElement('a');
		a.href = data_type + ', ' + table_html;
		/* a.download = 'table_div'
				+ Math.floor((Math.random() * 9999999) + 1000000) + '.xls'; */
		
		a.download =  Reportname 
			 + '.xls';
		
		a.click();
	});
</script>

<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- <script>
	$(document).ready(function() {
		
		var data = localStorage.getItem('generatedquery');
		
		 $.ajax({
		url : SERVER_URL+'/runExecutefinaQuery',
		type : 'POST',
		data : data,
		dataType : 'JSON',
		contentType : "application/json",
		success : function(data) {

			//alert("success" + JSON.stringify(data));
			data = data.returnData;

			

			console.log(data);
			bindreporttoexcel(data);
			//localStorage.setItem('queryOutput', JSON.stringify(data));
			//var finalqueryOutput = localStorage.getItem('queryOutput');
		//alert("finalqueryOutput" + finalqueryOutput);
			//window.open('10.html', '_self');
			//window.location.href('10.html');
		}
	}); 
		
		
		
		
		/* var Queryvalues = localStorage.getItem('queryOutput');
		//pase the value 
		var finalQueryvalues = JSON.parse(Queryvalues);
		alert("oooooo"+finalQueryvalues);
		bindreporttoexcel(finalQueryvalues); */
	});

	function bindreporttoexcel(finalQueryvalues) {
		var arr = finalQueryvalues;
		//alert("pppp"+arr);
		var table = "<html><table class='table table-bordered'>";

		if (arr.length > 0) {
			var col = [];
			for ( var key in arr[0]) {
				if (col.indexOf(key) === -1) {
					col.push(key);
				}
			}
		}

		for (i = 0; i < col.length; i++) {
			table = table + "<th>" + col[i] + "</th>";
		}

		for (j = 0; j < arr.length; j++) {

			table = table + "<tr>";

			for (i = 0; i < col.length; i++) {
				table = table + "<td>" + arr[j][col[i]] + "</td>";
			}
			table = table + "</tr>";
		}
		table += "</table></html>";
		document.getElementById("QueryResult").innerHTML = table;
	}
</script> -->
<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!--Data Table-->
<script type="text/javascript"  src="./js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/buttons/1.2.4/js/dataTables.buttons.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css"></script>
<script>
function createGrid(data) {
/* 	if(t1 != undefined) {
		//alert("lllllllllllll");
		t1.destroy();
	} */
	//alert("In Create Gridsdasdas");
	//data = '[{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"}, {"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"}, {"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":169419,"id":"PH"},{"product description":"                         ","vendor id":"VM","sequence id":123456,"id":"PH"}]';
	//data = JSON.parse(data);
	/*
	console.log(data);
	
	if (data.length > 0) {
		var col = [];
			for ( var key in data[0] ) {
				console.log(data[0][key]);
				for(var k in data[0][key]) {					
					if (col.indexOf(k) === -1) {
						col.push(k);
					}					
				}				
			}		
	}*/
	console.log(data);
	if (data.length > 0) {
		var col = [];
		//document.getElementById("example").innerHTML += "<tr>";
		for ( var key in data[0]) {
			if (col.indexOf(key) === -1) {
				col.push(key);				
				//document.getElementById("example").innerHTML += "<th>"+ key +"</th>";
			}
		}
		//document.getElementById("example").innerHTML += "</tr>";
	}
	dispCols = [];
	console.log(col);

	for(i=0; i<col.length; i++) {
		var jsonObj = {};
		jsonObj.data = col[i];
		jsonObj.title = col[i];
		dispCols.push(jsonObj);
	}
	

	console.log(dispCols);
	
	t1 = $("#example").DataTable({
        paging: true,
        select: "multi",
        searching: true,
        info: true,
        scrollX: true,
        data: data,
        columns: dispCols
	});
	
	document.getElementById("exportButton").style.display = "block";
}
  $("#header").load("header.html");
  $("#footer").load("footer.html");
</script>
</html>